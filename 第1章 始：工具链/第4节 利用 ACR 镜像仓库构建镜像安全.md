#### 什么是镜像安全

镜像安全是指在使用 Docker 或 Kubernetes 等容器技术时，确保使用的镜像是可信的、不含恶意软件和漏洞的。由于镜像中可能包含安全漏洞或恶意代码，如果使用不安全的镜像，则可能会导致容器被攻击或者数据泄露等安全问题。

镜像安全主要包括以下方面：

- 选择可信的镜像源：在使用 Docker 或 Kubernetes 时，可以从 Docker Hub 或其他可信的镜像源中下载镜像。确保选择的镜像源是可信的，镜像本身没有被篡改或污染。
- 使用最小化的镜像：使用最小化的镜像可以减少容器中存在的漏洞和攻击面。可以通过 Alpine 等轻量级 Linux 发行版来构建最小化的镜像。
- 定期更新镜像：定期更新镜像可以确保镜像中包含的软件和组件不含漏洞或已经得到修复。建议使用自动化工具来定期更新镜像。
- 镜像扫描和安全审计：使用镜像扫描和安全审计工具可以检测镜像中是否存在漏洞、恶意软件或其他安全问题。可以在镜像构建时或者部署时进行扫描和审计。
- 镜像签名和验证：镜像签名可以确保镜像的完整性和真实性，避免被篡改或替换。可以使用 Docker Content Trust 或其他签名工具来签名和验证镜像。

总之，镜像安全是容器安全的重要组成部分，需要在使用容器技术时重视和加以保障。

#### 选择阿里云容器镜像服务 ACR 的理由


| 云服务提供商                | 容器镜像仓库                         | 镜像扫描                              | 镜像签名     | 容器镜像加速器                           |
| --------------------------- | ------------------------------------ | ------------------------------------- | ------------ | ---------------------------------------- |
| Amazon Web Services (AWS)   | AWS Elastic Container Registry (ECR) | 支持 Amazon ECR Public 镜像的漏洞扫描 | 支持数字签名 | Amazon ECR Public                        |
| Microsoft Azure             | Azure Container Registry (ACR)       | Azure Security Center 容器安全扫描    | 支持数字签名 | Azure Container Registry Geo-replication |
| Google Cloud Platform (GCP) | Google Container Registry (GCR)      | 支持 Container Analysis 漏洞扫描      | 支持数字签名 | Google Container Registry                |
| Alibaba Cloud               | Container Registry                   | 支持容器镜像安全扫描                  | 支持数字签名 | 全球加速                                 |
| Tencent Cloud               | Tencent Hub                          | 支持镜像安全扫描                      | 支持数字签名 | Tencent Hub                              |
| IBM Cloud                   | IBM Cloud Container Registry         | 支持漏洞扫描                          | 支持数字签名 | IBM Cloud Container Registry             |
| Oracle Cloud Infrastructure | Oracle Cloud Infrastructure Registry | 支持镜像安全扫描                      | 支持数字签名 | Oracle Cloud Infrastructure Registry     |

需要注意的是，不同云服务提供商的具体功能和特点可能会随时更新和变化，以上表格仅供参考。
阿里云容器镜像服务（Container Registry）提供了完整的镜像管理和安全功能，包括以下方面：

镜像扫描：阿里云容器镜像服务提供了镜像安全扫描功能，可以检测镜像中是否存在漏洞、恶意软件或其他安全问题。用户可以在容器镜像服务控制台中开启安全扫描，并设置扫描的级别和频率。扫描结果会在控制台中展示，并提供详细的安全报告和修复建议。

镜像签名：阿里云容器镜像服务支持数字签名功能，用户可以对镜像进行签名，并验证签名的真实性。签名可以保证镜像的完整性和真实性，避免被篡改或替换。用户可以在控制台中设置镜像签名，并选择合适的签名方式。

镜像访问控制：阿里云容器镜像服务提供了细粒度的访问控制功能，用户可以设置镜像的访问权限和授权策略。可以授权指定用户或者组织访问镜像，也可以通过访问控制规则控制访问权限。这可以确保只有授权的用户可以访问镜像，避免未授权的访问和滥用。

安全报告和事件管理：阿里云容器镜像服务提供了安全报告和事件管理功能，可以在发现镜像安全问题时及时通知用户，并提供详细的修复建议和跟踪进度。用户可以在控制台中查看安全事件和修复进度，并及时采取相应的措施。

安全合规性：阿里云容器镜像服务支持多种安全合规性标准，如 CIS 基准、GDPR 等，用户可以在控制台中开启相应的合规性检测，并自动扫描和修复相关安全问题。这可以帮助用户满足安全合规性要求，保障数据和业务的安全。

#### 一个安全的镜像从签名开始

阿里云的容器镜像服务 ACR 可以对所有基于 Linux 的容器镜像进行安全扫描，自动识别镜像中的已知漏洞信息，并对漏洞信息进行评估和修复。这可以帮助用户更及时地发现并处理容器镜像中的安全问题，提高镜像的安全性。除此之外，ACR 还提供了支持私有仓库的功能，用户可以在安全的私有环境中存储和管理自己的容器镜像。同时，ACR 还提供了容器镜像的加速服务，可以提高容器镜像的下载速度，加速应用的部署。

1. 使用容器镜像服务 ACE 扫描镜像安全

#### 单镜像扫描

1. **登录**[容器镜像服务控制台](https://cr.console.aliyun.com/)。

#### 批量镜像扫描

批量镜像扫描功能支持使用Trivy扫描引擎和云安全扫描引擎，区别如下：* Trivy扫描引擎：开源扫描引擎，支持检测系统漏洞和应用漏洞，不支持一键修复系统漏洞功能。

* 云安全扫描引擎：阿里云自研的扫描引擎，支持检测系统漏洞、应用漏洞、基线检查和恶意样本，支持一键修复系统漏洞功能。
  * 系统漏洞：提供镜像系统漏洞扫描及一键修复能力，为您提供安全可信的镜像。
  * 应用漏洞：提供镜像应用漏洞扫描功能，为您扫描容器相关中间件上的漏洞，帮助您找到漏洞位置，便于您根据漏洞位置修复应用漏洞，创造安全的镜像运行环境。
  * 基线检查：提供镜像安全基线检查功能，为您扫描容器资产中存在的基线安全风险，帮助您找到存在的基线安全风险位置，便于您根据位置修复基线安全风险。
  * 恶意样本：提供容器恶意样本的检测能力，为您展示资产中存在的容器安全威胁，帮助您找到存在恶意样本的位置，便于您根据位置修复恶意样本，大幅降低您使用容器的安全风险。

1. **为企业版实例配置VPC网络。具体操作，请参见**[配置专有网络的访问控制](https://help.aliyun.com/document_detail/142199.htm#task1305 "当您的ECS位于专有网络时，需要为企业版实例配置专有网络的访问控制，才能建立ECS与企业版实例之间的连接。本文介绍如何为企业版实例配置专有网络的访问控制。")。
   您需要为企业版实例配置VPC网络，批量扫描镜像功能需要使用该VPC网络扫描镜像。首次使用云安全扫描引擎需要访问[云安全后台](https://yundun.console.aliyun.com/)，首次访问会提示您创建AliyunServiceRoleForSas系统角色。

   **说明** 如果您已为企业版实例配置VPC网络，无需执行此步骤。
2. **登录**[容器镜像服务控制台](https://cr.console.aliyun.com/)。
3. **在顶部菜单栏，选择所需地域。**
4. **在**实例列表**页面单击目标企业版实例。**
5. **在企业版实例管理页面选择**安全可信 > **镜像扫描**。
6. **选择扫描引擎。**

   * 设置扫描引擎为**Trivy扫描引擎**

     * 如果您之前未购买云安全扫描引擎，则**镜像扫描**页面右上角默认使用Trivy扫描引擎。
     * 如果您已购买云安全中心里的镜像扫描服务，Trivy扫描引擎就会切换成云安全扫描引擎，您需要在**镜像扫描**页面右上角单击**云安全扫描引擎**右侧的**切换**，单击**Trivy扫描引擎**，在**提示**对话框单击**确定**。
   * 设置扫描引擎为**云安全扫描引擎**如果您已购买云安全扫描引擎，则**镜像扫描**页面默认使用云安全引擎，您无需进行其他操作。如果您未购买云安全扫描引擎，您需要进行以下操作：

     1. 授予云安全中心调用ACR的OpenAPI权限。

        1. 单击[云资源访问授权](https://ram.console.aliyun.com/role/authorize?request=%7B%22ReturnUrl%22%3A%22https%3A%2F%2Fcr.console.aliyun.com%2F%22%2C%22Services%22%3A%5B%7B%22Roles%22%3A%5B%7B%22RoleName%22%3A%22AliyunContainerRegistryAccessingSASRole%22%2C%22TemplateId%22%3A%22AliyunContainerRegistryAccessingSASRole%22%7D%5D%2C%22Service%22%3A%22ContainerRegistry%22%7D%5D%7D)。
        2. 在**云资源访问授权**页面单击**同意授权**。
     2. 在**镜像扫描**页面**扫描信息**区域单击立即**升级云安全引擎**。
     3. 设置**安全扫描**为**云安全扫描引擎**，选中**容器镜像服务协议**，其他参数根据实际情况设置，单击**立即购买**，然后完成支付。返回**镜像扫描**页面，可以看到页面右上角已默认切换为云安全引擎。

        **说明** 购买云安全扫描引擎后，您可以在**镜像扫描**页面**扫描信息**区域单击**设置**，在**提示**对话框选中**同步**，然后单击**确定**。启用同步功能后，容器镜像服务将自动同步实例删除、镜像推送、镜像删除、镜像仓库删除的消息至云安全中心。
7. **创建扫描规则。**

   1. **在**镜像扫描**页面单击**创建规则**。**
   2. **在**扫描规则**配置向导中输入**规则名称**，设置**扫描范围**，然后单击**下一步**。**
      支持按照命名空间和仓库对镜像进行安全扫描：* 按照命名空间扫描：选择**命名空间**，输入镜像版本过滤的正则规则。

      * 按照仓库扫描：选择**命名空间**、**仓库**，输入镜像版本过滤的正则规则。
   3. **可选：**在**事件通知**配置向导中设置通知方式。
      支持钉钉、HTTP和HTTPS通知：* 钉钉：设置**通知方式**为**钉钉**，然后输入Webhook地址和加签密钥。

      * HTTP：设置**通知方式**为**HTTP**，然后输入HTTP地址。
      * HTTPS：设置**通知方式**为**HTTPS**，然后输入HTTPS地址。

      镜像扫描成功后，会发送通知给钉钉、HTTP或HTTPS。
   4. **单击**创建**。**
8. **手动触发镜像扫描。**

   **说明** 扫描规则创建完成后，支持手动和自动触发镜像扫描。自动触发指只要镜像推送或构建成功，就会自动触发镜像扫描。

   1. **在**镜像扫描**页面单击目标规则右侧**操作**列下的**立即扫描**。**
   2. **在弹出的对话框单击**确定**。**
      在**任务列表**区域看到扫描任务的**扫描状态**显示**扫描完成**，说明镜像扫描成功。
9. **查看扫描结果。**

   1. **在**镜像扫描**页面**任务列表**区域单击目标任务右侧**操作**列下的**查看任务**。**
   2. **在**任务详情**页面单击任务右侧**操作**列下的**查看详情**。**
      您可以在**安全扫描**页面查看扫描结果，包括安全漏洞详细信息。

      **说明** 如果您设置的扫描规则中包含多个镜像，则**任务详情**页面会存在多条任务，您可以查看任意一个任务的镜像扫描结果。
